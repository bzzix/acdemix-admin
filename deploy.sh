#!/bin/bash

# ูุชุบูุฑุงุช
PROJECT_DIR="/home/bzzix/public_html/acdemix/portal-admin"
APP_NAME="acdemix-admin"

echo "๐ ุจุฏุก ุนูููุฉ ุงููุดุฑ..."

# ุงูุงูุชูุงู ููุฌูุฏ ุงููุดุฑูุน
cd $PROJECT_DIR

# ุณุญุจ ุขุฎุฑ ุงูุชุญุฏูุซุงุช
echo "๐ฅ ุณุญุจ ุงูุชุญุฏูุซุงุช ูู GitHub..."
git pull origin main

# ุชุซุจูุช ุงูุชุจุนูุงุช
echo "๐ฆ ุชุซุจูุช ุงูุชุจุนูุงุช..."
npm install --production

# ุจูุงุก ุงููุดุฑูุน
echo "๐จ ุจูุงุก ุงููุดุฑูุน..."
npm run build

# ุฅูุดุงุก ูุฌูุฏ ุงูููุฌุฒ ุฅุฐุง ูู ููู ููุฌูุฏุงู
mkdir -p logs

# ุฅููุงู ุงูุชุทุจูู ุฅุฐุง ูุงู ูุนูู
echo "โน๏ธ ุฅููุงู ุงูุชุทุจูู..."
pm2 stop $APP_NAME 2>/dev/null || true

# ุชุดุบูู ุงูุชุทุจูู
echo "โถ๏ธ ุชุดุบูู ุงูุชุทุจูู..."
pm2 start ecosystem.config.js --env production

# ุญูุธ ุฅุนุฏุงุฏุงุช PM2
pm2 save

# ุฅุนุฏุงุฏ ุจุฏุก ุชููุงุฆู ุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู
pm2 startup

echo "โ ุชู ุงููุดุฑ ุจูุฌุงุญ!"
echo "๐ ุญุงูุฉ ุงูุชุทุจูู:"
pm2 status